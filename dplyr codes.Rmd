---
title: "dplyr sample codes"
author: "Sedi Abbasnasab"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
require(dplyr)
```
#load data
```{r}
demo <- read.csv("demographics.csv")
View(demo)
```
#filtering
#owners with the income greater than 55
```{r}
demo2 <- filter(demo, income>55)
View(demo2)
```
#owners with income equal to 60
```{r}
demo2 <- filter(demo, income==60)
View(demo2)
```
#married owners
```{r}
demo2 <- filter(demo, marital=='Married')
View(demo2)
```
#married owners with the income greater than 55
```{r}
demo2 <- filter(demo, marital=='Married', income>55)
View(demo2)
```
#multiple conditions
```{r}
demo2 <- filter(demo, marital=='Married', income>55, carcat=='Luxury')
View(demo2)
```
#owners with age between 35 and 45
```{r}
demo2 <- filter(demo, age>=35, age<=45)
View(demo2)
```
#owners who are married OR the income greater than 55
```{r}
demo2 <- filter(demo, income>55 | marital=='Married')
View(demo2)
```
#owners aged 42, 45 and 60
```{r}
demo2 <- filter(demo, age %in% c(42, 45, 60))
View(demo2)
```
#owners with the ages different from 42, 45 and 60
```{r}
demo2 <- filter(demo, !age %in% c(42, 45, 60))
View(demo2)
```

#Select
#select the variables age, marital status and gender
```{r}
demo2 <- select(demo, age, marital, gender)
View(demo2)
```
#use colon to select a range of variables
```{r}
demo2 <- select(demo, income:carcat)
View(demo2)
```
#select the third and the fifth variable
```{r}
demo2 <- select(demo, c(3, 5))
View(demo2)
```
#select the variables from the second to the forth
```{r}
demo2 <- select(demo, 2:4)
View(demo2)
```
#remove variables age and income
```{r}
demo2 <- select(demo, -age, -income)
View(demo2)
```
#remove the sixth and the eighth variable
```{r}
demo2 <- select(demo, -6, -8)
View(demo2)
```
#remove the first three variables
```{r}
demo2 <- select(demo, -1:3)
View(demo2)
```
#select the variables that contain a certain string
```{r}
demo2 <- select(demo, contains("ret"))
View(demo2)
```
#select the variables that start with the specified string
```{r}
demo2 <- select(demo, starts_with("in"))
```
#select the variables that end with the specified string
```{r}
demo2 <- select(demo, ends_with("cat"))
View(demo2)
```

#Mutate
#add a new variable containing the difference between income and car price
```{r}
demo2 <- mutate(demo, income2 = income * 10)
View(demo2)
```
#add another variable containing the difference between income and car price
```{r}
demo2 <- mutate(demo, diff = income - carpr)
View(demo2)
```
#Creat a vector and add it to data frame as a variable
#the vector lenght must be equal to the number of rows in the data frame
```{r}
y <- rnorm(510, 0, 1)
demo2 <- mutate(demo2, new_var=y)
View(demo2)
```
#divide variables 1 and 5 to 1000
```{r}
demo2 <- mutate(demo2, across(c(1,5), ~ ./1000, .names = "{col}_2"))
View(demo2)
```
#devide all the numeric variables to 1000
```{r}
demo2 <- mutate(demo, across(where(is.numeric), ~ ./1000, .names = "{col}_2"))
View(demo2)
```
#multiply colums 1 and 5 by 3
```{r}
demo2 <- mutate(demo, across(c(1,5), ~ .*3, .names = "{col}_new"))
View(demo2)
```
#compute the means of the columns 1 and 5
```{r}
demo2 <- mutate(demo, across(c(1,5), .fns = mean, .names = "{col}_mean"))
View(demo2)
```
#compute the means of all numeric variables
```{r}
demo2 <- mutate(demo, across(where(is.numeric), .fns = mean, .names = "{col}_mean"))
View(demo2)
```
#use the filter() function inside the mutate() function
#divide columns 1,3 and 5 by 1000 for the retired owners only
```{r}
demo2 <- mutate(filter(demo, retired =="Yes"), across(c(1,3, 5), ~ ./1000, .names = "{col}_2"))
View(demo2)
```

#Arrange
#sort by income in ascending order
```{r}
demo2 <- arrange(demo, income)
View(demo2)
```
#sort by income in descending order
```{r}
demo2 <- arrange(demo, desc(income))
View(demo2)
```
#sort by education level from A to Z
```{r}
demo2 <- arrange(demo, educ)
View(demo2)
```
#sort by education level from Z to A
```{r}
demo2 <- arrange(demo, desc(educ))
View(demo2)
```
#sort by income and education, in ascending order
```{r}
demo2 <- arrange(demo, income, educ)
View(demo2)
```
#sort by education and income in ascending order
```{r}
demo2 <- arrange(demo, educ, income)
View(demo2)
```
#sort by income in ascending order and by education in descending order
```{r}
demo2 <- arrange(demo, income, desc(educ))
View(demo2)
```

#Summarise
#compute the mean of income
```{r}
meaninc <- summarise(demo, avginc=mean(income, na.rm=TRUE))
View(meaninc)
typeof(meaninc)
```
#compute the standard deviation of income
```{r}
sdinc <- summarise(demo, sdincome=sd(income, na.rm = TRUE))
View(sdinc)
```
#compute the sum of the income values
```{r}
suminc <- summarise(demo, suminc=sum(income, na.rm = TRUE))
View(suminc)
```
#compute the median of the income
```{r}
medinc <- summarise(demo, medinc=median(income, na.rm = TRUE))
View(medinc)
```
#find the maximum income
```{r}
maxinc <- summarise(demo, maxinc=max(income, na.rm = TRUE))
View(maxinc)
```
#compute the variance of income
```{r}
varinc <- summarise(demo, varinc=var(income, na.rm = TRUE))
View(varinc)
```
#the number of rows in the dataset
```{r}
summarise(demo, n())
```
#compute several statistics at once
```{r}
summarise(demo, avginc=mean(income, na.rm = TRUE), sdinc=sd(income, na.rm = TRUE), varinc=var(income, na.rm = TRUE))
```
#combine summarise with other functions, like filter
#compute the average income, the standard deviation of the income, and the number of rows for the observations where the age is greater than 35
```{r}
summarise(filter(demo, age>35), avginc=mean(income, na.rm = TRUE), sdinc=sd(income, na.rm = TRUE), n())
```
#compute the average income, the standard deviation of the income and the number of rows for the male owners
```{r}
summarise(filter(demo, gender=='Male'), avginc=mean(income, na.rm = TRUE), sdinc=sd(income, na.rm = TRUE), n())
```
#compute the mean for the variables age and car price
```{r}
summarise(demo, across(c(1,5), mean))
```
#compute the mean for all numeric variables
```{r}
summarise(demo, across(where(is.numeric), mean))
```
#compute the mean for all the numeric variables but for the luxury car owners only
```{r}
summarise(filter(demo, carcat=='Luxury'), across(where(is.numeric), mean))
```
#compute the standard deviation for all the numeric variables but for the luxury car owners only
```{r}
summarise(filter(demo, carcat=='Luxury'), across(where(is.numeric), sd))
```
#comupte the mean for the variables that start with the letter "c"
```{r}
summarise(demo, across(starts_with("c"), mean))
```
#compute the mean for the numeric variables that start with the letter "c"
```{r}
summarise(demo, across(starts_with("c") & where(is.numeric), mean))
```
#extract the variables in a seprate data frame and use everything argument in the across function
```{r}
demo2 <- select(demo, age, income, carpr)
View(demo2)
summarise(demo2, across(everything(), mean))
```

# group by
# group the demo data frame by the categories of the variable education
```{r}
demo2 <- group_by(demo, educ)
View(demo2)
```
# compute the average income
```{r}
summarise(demo, avginc=mean(income))
```
# compute the standard deviation of the variable car price
```{r}
summarise(demo, sdcarpr=sd(carpr))
```
# select from the demo2 data the owners that are older than 40
```{r}
demo3 <- filter(demo2, age>40)
View(demo3)
```
# compute the average income in the demo3 data frame
```{r}
summarise(demo3, avginc=mean(income))
```
# compute the means  of columns 1 and 4 with the across function
```{r}
summarise(demo2, across(c(1,4), mean))
```
# compute the means of all numeric variables for the luxury cars only
```{r}
summarise(filter(demo2, carcat == 'Luxury'), across(where(is.numeric), mean))
```

# Count()
# count the rows in the demo data frame
```{r}
count(demo)
```
# count the rows where the income is smaller than 100
```{r}
count(filter(demo, income < 100))
```
# count the number of rows for each education level
```{r}
count(demo, educ)
```
# count the number of owners in each combination of  the variables gender and retired
```{r}
count(demo, gender, retired)
```
# the add_count function adds a column (variable) containing the number of rows
```{r}
demo2 <- add_count(demo)
View(demo2)
```

#tally()
# compute the income sum
```{r}
tally(demo, income)
```
# compute the car prices sum
```{r}
tally(demo, carpr)
```
# add a variable containing the number of rows
```{r}
demo2 <- add_tally(demo)
```
# add a variable containing the sum of the incomes
```{r}
demo3 <- add_tally(demo, income)
View(demo3)
```

# n_distinct()
# extract the variable educ as a vector and compute the number of unique values in this vector
```{r}
educ <- demo$educ
n_distinct(educ)
```
# extract the variable income as a vector and compute the number of unique values in this vector
```{r}
inc <- demo$income
n_distinct(inc)
```
# if the argument of the n_distinct() function is a data frame the function returns the number of rows
```{r}
n_distinct(demo)
```

# sample()
# the sample_n() function extracts a number of rows, at random
```{r}
demo_s <- sample_n(demo, 100)
View(demo_s)
```
# sampling with replacement
```{r}
demo_s <- sample_n(demo, 100, replace = TRUE)
View(demo_s)
```
# when we do sampling with replacement, the number of extracted rows can be greater than the number of rows in the initial data frame
# create a data frame with 5 rows and extract 100 rows with replacement
```{r}
id <- 1:5
names <- c("Tom", "Mary", "Nicolas", "Diana", "Ellen")
dat <- data_frame(id, names)
View(dat)
dat_s <- sample_n(dat, 100, replace = TRUE)
View(dat_s)
```
# sample_frac() extracts a fraction of rows at random
# extract 30% of rows
```{r}
demo_s2 <- sample_frac(demo, 0.3)
View(demo_s)
```
# extract 30% of rows with replacement
```{r}
demo_s2 <- sample_frac(demo, 0.3, replace = TRUE)
View(demo_s2)
```
# top_n()
# extract the top 10 owners based on income
```{r}
demo2 <- top_n(demo, 10, income)
View(demo2)
```
# extract the top 10 owners based on age
```{r}
demo2 <- top_n(demo, 10, age)
View(demo2)
```
# bind()
# create a data frame that contains the first 10 rows of demo
```{r}
demo1 <- demo[1:10,]
View(demo1)
```
# create a data frame that contains the last 10 row od demo
```{r}
demo2 <- demo[501:510,]
View(demo2)
```
# bind the two data frame with bind_row()
```{r}
demo_b <- bind_rows(demo1, demo2)
View(demo_b)
```
# bind_cols()
# create a data frame that contains the first 3 columns of demo
```{r}
demo1 <- demo[,1:3]
View(demo1)
```
# create a data frame that contains the last 5 columns of demo
```{r}
demo2 <- demo[,4:8]
View(demo2)
```
# bind the two data frames by columns
```{r}
demo_b <- bind_cols(demo1, demo2)
View(demo_b)
```

